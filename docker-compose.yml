services:
  api:
    build:
      context: .
      dockerfile: api/Dockerfile
    container_name: glyf-api
    environment:
      DATABASE_URL: ${DATABASE_URL}
      SENDGRID_API_KEY: ${SENDGRID_API_KEY}
      APP_URL: ${APP_URL}
      JWT_SECRET: ${JWT_SECRET}
      SMTP_FROM: ${SMTP_FROM}
      PORT: 8000
      DENO_ENV: production
    ports:
      - "8500:8000"
    volumes:
      - ./api:/app
    command: deno task start

  web:
    build:
      context: .
      dockerfile: ui/Dockerfile
    container_name: glyf-web
    environment:
      VITE_API_URL: https://glyf.bravno.com
      VITE_POSTHOG_KEY: ${VITE_POSTHOG_KEY:-}
      NODE_ENV: production
    ports:
      - "8600:80"
